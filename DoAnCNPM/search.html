<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kết quả tìm kiếm - HypeHype</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" 
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="bg-gray-100 font-sans">
  <!-- Header -->
  <header class="bg-white shadow-md py-4">
    <div class="container mx-auto flex items-center justify-between px-4">
      <a href="/" class="flex items-center">
        <img src="https://nhanam.com.vn/themes/nhanam/images/logo.svg" alt="Nhã Nam Logo" class="h-8">
      </a>
      <nav class="hidden md:flex items-center space-x-8">
        <a href="index.html" class="text-gray-700 hover:text-green-500 transition duration-300">Trang chủ</a>
        <a href="#" class="text-gray-700 hover:text-green-500 transition duration-300">Tin Sách</a>
        
        <!-- Dropdown Sách Nhã Nam -->
        <div class="relative group">
          <button class="flex items-center text-gray-700 font-semibold hover:text-green-500 transition duration-300">
            <span class="mr-1">Hype vũ trụtrụ</span>
            <svg class="fill-current h-4 w-4 transform group-hover:rotate-180 transition duration-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
              <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
            </svg>
          </button>
          <ul class="absolute left-0 mt-2 w-40 bg-white shadow-lg rounded-md invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all duration-300">
            <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-green-100">Văn học</a></li>
            <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-green-100">Kinh tế</a></li>
            <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-green-100">Thiếu nhi</a></li>
          </ul>
        </div>
        
        <a href="#" class="text-gray-700 hover:text-green-500 transition duration-300">Tác giả</a>
        
        <!-- Dropdown Cuộc Thi -->
        <div class="relative group">
          <button class="flex items-center text-gray-700 font-semibold hover:text-green-500 transition duration-300">
            <span class="mr-1">Cuộc Thi</span>
            <svg class="fill-current h-4 w-4 transform group-hover:rotate-180 transition duration-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
              <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
            </svg>
          </button>
          <ul class="absolute left-0 mt-2 w-40 bg-white shadow-lg rounded-md invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all duration-300">
            <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-green-100">Sách mới</a></li>
            <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-green-100">Sách bán chạy</a></li>
          </ul>
        </div>
        
        <a href="#" class="text-gray-700 hover:text-green-500 transition duration-300">Về Nhã Nam</a>
        <a href="#" class="text-gray-700 hover:text-green-500 transition duration-300">Liên hệ</a>
      </nav>
      <div class="flex items-center space-x-4">
        <div class="relative">
          <input id="searchInput2" type="text" placeholder="Tìm kiếm..." class="border rounded-full py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-green-500">
          <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>
        <a href="#" class="hover:text-green-500"><i class="fas fa-user"></i></a>
        <a href="#" class="hover:text-green-500"><i class="fas fa-shopping-cart"></i></a>
      </div>
      <button class="md:hidden text-gray-700 focus:outline-none">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </header>
  <div class="bg-green-500 h-3 w-full"></div>

  <!-- Breadcrumb -->
  <nav class="container mx-auto py-4 px-4">
    <a href="/" class="text-green-500 hover:underline">Trang chủ</a>
    <span class="text-gray-500 mx-2">/</span>
    <span class="text-gray-700">Kết quả tìm kiếm</span>
  </nav>

  <!-- Container hiển thị kết quả -->
  <main class="container mx-auto px-4 py-8">
    <div id="searchResults">
      <h2 class="text-3xl font-bold mb-6 text-center">Kết quả tìm kiếm cho: "<span id="queryDisplay"></span>"</h2>
      <div id="resultsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-200 py-6 mt-10">
    <div class="container mx-auto text-center">
      <p class="text-gray-600">© 2023 Nhã Nam. All rights reserved.</p>
    </div>
  </footer>

  <!-- JavaScript: Lấy query từ URL, gọi API và hiển thị kết quả -->
  <script>
    // Lấy query parameter từ URL
    const params = new URLSearchParams(window.location.search);
    const query = params.get('q');
    document.getElementById('queryDisplay').textContent = query;

    const resultsGrid = document.getElementById('resultsGrid');

    // Hàm gọi API và hiển thị kết quả
    function performSearch(query) {
      fetch(`http://localhost:3000/api/search?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
          resultsGrid.innerHTML = '';
          if (data.results && data.results.length > 0) {
            data.results.forEach(item => {
              const card = document.createElement('div');
              card.className = 'bg-white p-6 rounded-lg shadow-lg hover:shadow-2xl transition duration-300';
              card.innerHTML = `
                <h3 class="font-bold text-xl mb-2 text-green-600">${item.TenSach}</h3>
                <p class="text-gray-700 mb-1"><i class="fas fa-user mr-2"></i>Tác giả: ${item.author}</p>
                <p class="text-gray-600"><i class="fas fa-barcode mr-2"></i>Mã đầu sách: ${item.MaDS}</p>
              `;
              resultsGrid.appendChild(card);
            });
          } else {
            resultsGrid.innerHTML = '<p class="text-gray-600 col-span-full text-center">Không tìm thấy kết quả nào.</p>';
          }
        })
        .catch(error => {
          console.error("Error:", error);
          resultsGrid.innerHTML = '<p class="text-red-500 col-span-full text-center">Có lỗi xảy ra khi tìm kiếm.</p>';
        });
    }

    if (query && query.trim().length > 0) {
      performSearch(query);
    } else {
      resultsGrid.innerHTML = '<p class="text-gray-600 text-center">Vui lòng nhập từ khóa để tìm kiếm.</p>';
    }

    // Tương tự, nếu người dùng muốn tìm kiếm lại trên trang này
    const searchInput2 = document.getElementById('searchInput2');
    searchInput2.addEventListener('keyup', (event) => {
      if (event.key === 'Enter') {
        const newQuery = searchInput2.value.trim();
        if(newQuery.length >= 1){
          window.location.href = `search.html?q=${encodeURIComponent(newQuery)}`;
        }
      }
    });
  </script>
</body>
</html>
